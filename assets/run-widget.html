<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{name}} - Fliplet Widget Development</title>
        <style type="text/css">
            * {
                box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            body {
                overflow-y: hidden;
                background-color: #F2F6F7;
                font-family: sans-serif;
            }
            html, body {
                height: 100%;
            }
            #content {
                display: flex;
                height: 100%;
            }
            section {
                position: relative;
                width: 50%;
                height: 100%;
                padding: 20px 30px;
            }
            section h2 {
                text-transform: uppercase;
                font-weight: normal;
                font-size: 13px;
                font-weight: bold;
                margin-bottom: 10px;
            }
            section h2 a {
                color: #777;
                text-decoration: none;
                border-bottom: 1px dotted #AAA;
            }
            iframe {
                background: #FFF;
                width: 100%;
                height: 100%;
                border: 1px solid #D9DDDE;
            }
            #iframe-interface {
                background-color: #F2F6F7;
                padding-bottom: 63px;
            }
            #iframe-build {
                border: 40px solid #EAEAEA;
                border-radius: 10px;
            }
            footer {
                position: absolute;
                bottom: 0;
                left: 30px;
                right: 30px;
                border-top: 1px solid #D9DDDE;
            }
            footer a {
                display: block;
                background-color: #00ABD1;
                color: #FFF;
                border-radius: 4px;
                padding: 10px;
                margin: 10px;
                text-decoration: none;
                text-align: center;
                width: 150px;
            }
        </style>
    </head>
    <body>
        <div id="content">
            <section>
                <h2><a href="/interface" target="_blank">{{name}} interface</a></h2>
                <iframe src="/interface" id="iframe-interface" /></iframe>
                <footer><a href="#" id="saveButton">Save &amp; Close</a></footer>
            </section>
            <section>
                <h2><a href="/build" target="_blank">output of your component</a></h2>
                <iframe src="/build" id="iframe-build" /></iframe>
            </section>
        </div>
        <script>
        var saveButton = document.getElementById('saveButton');
        var interface = document.getElementById('iframe-interface');
        var build = document.getElementById('iframe-build');

        saveButton.addEventListener('click', function (event) {
            event.preventDefault();
            interface.contentWindow.postMessage('save-widget', '*');
        }, false);

        window.addEventListener('message', receiveMessage, false);

        function receiveMessage (event) {
          if (event.data) {
            switch (event.data.event) {
                case 'widget-save-disable':
                    saveButton.style.display = 'none';
                    break;
                case 'widget-save-enable':
                    saveButton.style.display = 'block';
                    break;
                case 'widget-save-complete':
                    interface.contentWindow.location.reload();
                    build.contentWindow.location.reload();
                    break;
                case 'widget-display-message':
                    alert(event.data.text);
                    break;
                case 'reload-widget-instance':
                    build.contentWindow.location.reload();
                    break;
            }
          }
        }

        </script>
    </body>
</html>